$(document).ready(function() {

    //100vh for mobile
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);

    mobileNav();

    //init Main Slick
    initMainSlick();
    initHomepageSlider();

    $('.tab-link').on('click', function(event) {
        var id = $(this).attr('data-id');
        $(this).closest('.tab').find('.tab-container').removeClass('active').hide();
        $(this).closest('.tab').find('.tab-link').removeClass('active');
        $(this).addClass('active');
        $('#'+id).addClass('active').fadeIn();
        return false;
    });

    $('.hamburger').on('click', function () {
        $(this).toggleClass('is-active');
        $('.menu').toggleClass('menu--open');
        $('body').toggleClass('menu-open');
    })

    $('.news-popup__close').on('click', function () {
        $('.popup').removeClass('popup--open');
    })

    $('.login-popup__close').on('click', function () {
        $('.popup').removeClass('popup--open');
    })

    $('.news').on('click', function () {
        let id = $(this).attr('id');
        $('#popup-'+id).toggleClass('popup--open');
    })

    $('.gallery-for').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        prevArrow: "<button type='button' class='slick-prev'><i class='icon icon-angle-left' aria-hidden='true'></i></button>",
        nextArrow: "<button type='button' class='slick-next'><i class='icon icon-angle-right' aria-hidden='true'></i></button>",
        fade: true,
        asNavFor: '.gallery-nav',
        responsive: [
            {
                breakpoint: 1025,
                settings: {
                    arrows: false
                }
            }
        ]
    });

    $('.gallery-nav').slick({
        slidesToScroll: 1,
        asNavFor: '.gallery-for',
        centerMode: true,
        prevArrow: "<button type='button' class='slick-prev'><i class='icon icon-angle-left' aria-hidden='true'></i></button>",
        nextArrow: "<button type='button' class='slick-next'><i class='icon icon-angle-right' aria-hidden='true'></i></button>",
        variableWidth: true,
        focusOnSelect: true
    });

    $('.tab-navigation').slick({
        slidesToShow: 4,
        slidesToScroll: 1,
        prevArrow: "<button type='button' class='slick-prev'><i class='icon icon-angle-left' aria-hidden='true'></i></button>",
        nextArrow: "<button type='button' class='slick-next'><i class='icon icon-angle-right' aria-hidden='true'></i></button>",
        responsive: [
            {
                breakpoint: 767,
                settings: {
                    slidesToShow: 4,
                    slidesToScroll: 1,
                    arrows: false,
                    infinite: true,
                    swipe: false,
                    touchMove: false
                }
            }
        ]
    });

    $('.section-down').on('click', function (e) {
        e.preventDefault();
        $('.homepage').not('.slick-cloned').find('.homepage-slider').slick('slickNext');
    })

    $('.section-up').on('click', function (e) {
        e.preventDefault();
        $('.homepage').not('.slick-cloned').find('.homepage-slider').slick('slickPrev');
    })

    $('.news-chapter__button').on('click', function (e) {
        e.preventDefault();
        $('.news-chapter__wrap').slideToggle();
    })

    $('.news-chapter__item-title').on('click', function (e) {
        if($(this).is('.has-child')) {
            e.preventDefault();

            if ($(this).is('.show')) {
                $(this).removeClass('show');
            } else {
                $('.news-chapter__item-title').removeClass('show');
                $(this).addClass('show');
            }
        }
    })

    $('.news-chapter__sub-title').on('click', function (e) {
        if($(this).is('.has-child')) {
            e.preventDefault();

            if ($(this).is('.show')) {
                $(this).removeClass('show');
            } else {
                $('.news-chapter__sub-title').removeClass('show');
                $(this).addClass('show');
            }
        }
    })

    $('.popup').on('scroll', function (){

        $('.js-history-item').each( function(){
            var offsetItem = $(this).offset().top + $(this).outerHeight();
            var offsetWindow = $('.popup').scrollTop() + $('.popup').height() + 500;

            if(offsetWindow > offsetItem){
                $(this).addClass('show');
            }
        });

        $('.history-section').each(function() {
            if ($(this).offset().top - 50 < 0) {
                var currentId = $(this).data('section-id');
                var currentImg = $(this).attr('data-bg-url');

                $('.history-bg').css('background-image', 'url(' + currentImg + ')');
                $('.js-section-nav').removeClass('active');
                $(".js-section-nav[data-section='" + currentId +"']").addClass('active');
            }

        });
    });

    $('.js-section-nav').on('click', function (e) {
        e.preventDefault();

        $('.js-section-nav').removeClass('active');
        $(this).addClass('active');
        var dataNav = $(this).attr('data-section');

        $('.popup').stop().animate({
            scrollTop: $(".history-section[data-section-id='" + dataNav +"']").position().top
        }, 500);
    })

    $('.js-toggle-profile-menu').on('click', function (e) {
        e.preventDefault();
        $(this).toggleClass('profile-mobile-list--active');
        $('.js-profile-nav').slideToggle();
    })

});

$(document).keydown(function(e) {
    var code = e.keyCode || e.which;
    if (code == 27)
        $(".popup").removeClass('popup--open');
        $(".menu").removeClass('menu--open');
        $('body').removeClass('menu-open');
        $('.hamburger').removeClass('is-active');
});

$('.main-section').on('DOMMouseScroll mousewheel', function (e) {
    if(e.originalEvent.detail > 0 || e.originalEvent.wheelDelta < 0) {
        $(".main-section").slick('slickNext');
    } else {
        if ($('.main-section .slide.slick-current').attr('data-slick-index') == '0') {
        } else {
            $(".main-section").slick('slickPrev');
        }
    }
    return false;
});

// $(window).on('load', function() {
//     $('.loader-wrap').fadeOut().end().delay(1000).fadeOut('slow');
// });

$(window).on('resize', function() {
    //100vh for mobile
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);

    mobileNav();
});

function initHomepageSlider() {
    $('.homepage-slider').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        infinite: false,
        arrows: false,
        speed: 1500,
        swipe: false,
        touchMove: false,
        vertical: true
    });

    $(window).on('resize', function() {
        var newWidth = $(window).width()
        var slickNotClone = $('.homepage').not('.slick-cloned').find('.homepage-slider');
        if (newWidth < 768) {
            slickNotClone.slick('unslick');
        } else {
            if (slickNotClone.is('.slick-initialized')) {
                return;
            } else {
                slickNotClone.slick({
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    infinite: false,
                    arrows: false,
                    speed: 1500,
                    swipe: false,
                    touchMove: false,
                    vertical: true
                });
            }
        }
    });
}

function mobileNav() {
    $('.menu-list__headline').off('click').on('click', function (e) {
        var windowWidth = $(window).width();

        if(windowWidth < 767) {
            e.preventDefault();

            var parent = $(this).parents('.menu-list');

            if(parent.is('.active')) {
                parent.removeClass('active');
                $('.menu-list').removeClass('hide');
                $('.menu-list__nav').removeClass('active');
            } else {
                $('.menu-list').addClass('hide');
                parent.removeClass('hide').addClass('active');
                parent.find('.menu-list__nav').addClass('active');
            }
        }
    })
}

function initMainSlick() {
    $('.main-section').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        nextArrow: '<div class="fp-controlArrow fp-next"></div>',
        prevArrow: '<div class="fp-controlArrow fp-prev"></div>',
        dots: true,
        touchMove: false,
        draggable: false,
        speed: 1000,
        mobileFirst: true,
        responsive: [
            {
                breakpoint: 768,
                settings: {
                    speed: 1500
                }
            }
        ]
    });

    var height = window.innerHeight;
    var a = setInterval(function() {
        $(window).scrollTop(-1);
        resize();
    }, 500);

    $(window).on('orientationchange', function() {
        resize();
    });

    var resize = function() {
        if(window.innerHeight != height) {
            height = window.innerHeight;
            $('.slide').css('height', height + 'px');
        }
    };

    var currentHash = window.location.hash;

    if (currentHash.indexOf('#') !== -1) {
        currentHash = currentHash.replace('#','');
        $('.main-section').find('.slide').each(function () {
            var eachAnchor = $(this).not('.slick-cloned').attr('data-anchor');
            if (eachAnchor == currentHash) {
                var slickToGo = $(this).attr('data-slick-index');
                $('.main-section').slick('slickGoTo' , slickToGo);
            }
        });
    }

    $('.main-section').on('afterChange', function(event, slick, currentSlide, nextSlide){
        if(slick.$slider[0].className.indexOf('main-section') !== -1) {
            var currentSlide = $('.main-section .slide.slick-current');
            var currentAnchor = currentSlide.attr('data-anchor');
            window.location.hash = currentAnchor;

            var currentIndex = currentSlide.attr('data-slick-index') == 0;
            if (currentIndex) {
                $('.fp-prev').removeClass('show');
            } else {
                $('.fp-prev').addClass('show');
                if ($('.homepage').not('.slick-cloned').find('.homepage-slider').is('.slick-initialized')) {
                    $('.homepage').not('.slick-cloned').find('.homepage-slider').slick('slickGoTo' , 0);
                }
            }
        }
    });
}

